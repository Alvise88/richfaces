<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:it="http://richfaces.org/iteration"
	xmlns:a4j="http://richfaces.org/a4j">
<f:view contentType="text/html" />

<h:head>
	<title>Richfaces Tree</title>
	
	<h:outputStylesheet>/*<![CDATA[*/
	.customClass .customNodeClass {
		border: 1px solid navy;
	}

	.customClass .customHandleClass {
		border: 1px solid red;
	}

	.customClass .customIconClass {
		border: 1px solid yellow;
	}

	.customClass .customLabelClass {
		border: 1px solid green;
	}

	/*]]>*/</h:outputStylesheet>
</h:head>

<h:body>
	<h:outputScript>
		function getNodeStateString(treeNode) {
			return treeNode.isLeaf() ? 
				'leaf' 
				: (treeNode.isExpanded() ? 'expanded' : 'collapsed');
		}
	
		function handleNodeToggle(nodeData, event, isTreeNodeLevel) {
			var treeNode = RichFaces.$(event.target);
			RichFaces.log.info('Toggle event ' + (isTreeNodeLevel ? '(treeNode level)' : '') 
				+ '[' + nodeData + ']:\n ' + treeNode.getId() + ' became ' + getNodeStateString(treeNode));
		}

		function handleNodeSelect(event) {
			var treeNode = RichFaces.$(event.target);
			
			var selectedNodes = event.rf.data.selection;
			var selection = new Array();
			jQuery.each(selectedNodes, function(k, v) {
				selection.push(v.getId());
			});
			
			RichFaces.log.info('Select event:\n ' + selection.join(''));
		}
	</h:outputScript>

	<h:messages id="messages" />

	<h:form>
		Toggle mode: <h:selectOneRadio value="#{treeBean.toggleType}" onclick="submit()">
			<f:selectItems value="#{treeBean.types}" var="item" itemValue="#{item}" />
		</h:selectOneRadio>

		Selection mode: <h:selectOneRadio value="#{treeBean.selectionType}" onclick="submit()">
			<f:selectItems value="#{treeBean.types}" itemDisabled="#{item == 'server'}" var="item" itemValue="#{item}" />
		</h:selectOneRadio>
		
		Show custom classes: <h:selectBooleanCheckbox value="#{treeBean.showCustomClasses}" onclick="submit()" />
	</h:form>

	<h:form id="form">
		Base tree:
		<it:tree id="tree" nodeType="#{node.parent == null ? 'rootNode': 'childNode'}" var="node" value="#{treeBean.rootNodes}" 
			selectionType="#{treeBean.selectionType}" toggleType="#{treeBean.toggleType}" selection="#{treeBean.selection}">
			<it:treeNode type="rootNode">
				<h:panelGroup id="rootNodeGroup">
					Root node: #{node.data} - 
					<h:commandLink value="link" action="#{treeBean.clickNode}">
						<f:setPropertyActionListener value="#{node.data}" target="#{treeBean.nodeData}" />
					
						<f:ajax render=":messages" />						
					</h:commandLink>
				</h:panelGroup>
			</it:treeNode>
			<it:treeNode type="childNode">
				<h:panelGroup id="childNodeGroup">
					#{node.data} - 
					<h:commandLink value="link" action="#{treeBean.clickNode}">
						<f:setPropertyActionListener value="#{node.data}" target="#{treeBean.nodeData}" />
					
						<f:ajax render=":messages" />						
					</h:commandLink>
				</h:panelGroup>
			</it:treeNode>
		</it:tree>

		<h:commandLink value="Re-render">
			<f:ajax render=":form:tree" execute="@all" />
		</h:commandLink>

		Tree with customized look:
		<it:tree id="customizedTree" var="node" value="#{treeBean.rootNodes}" 
			selectionType="#{treeBean.selectionType}" toggleType="#{treeBean.toggleType}"
			styleClass="#{treeBean.showCustomClasses ? 'customClass' : ''}"
			nodeClass="customNodeClassFromTree"
			handleClass="customHandleClassFromTree" iconClass="customIconClassFromTree" labelClass="customLabelClassFromTree">
			
			<it:treeNode iconLeaf="/images/leaf.png" iconExpanded="/images/minus.png" iconCollapsed="/images/plus.png"
			styleClass="customNodeClass" handleClass="customHandleClass" iconClass="customIconClass" labelClass="customLabelClass">
			#{node.data}
			</it:treeNode>
		</it:tree>

		Tree with default node:
		<it:tree id="defaultNodeTree" var="node" value="#{treeBean.rootNodes}" 
			selectionType="#{treeBean.selectionType}" toggleType="#{treeBean.toggleType}">
		</it:tree>
		
		Tree with client-side event handlers:
		<it:tree id="clientSideEventsTree" var="node" value="#{treeBean.rootNodes}" 
			selectionType="#{treeBean.selectionType}" toggleType="#{treeBean.toggleType}"
			onnodetoggle="handleNodeToggle(&quot;#{node.data}&quot;, event, false)"
			onselectionchange="handleNodeSelect(event)">
			
			<it:treeNode ontoggle="handleNodeToggle(&quot;#{node.data}&quot;, event, true)">
				#{node.data}
			</it:treeNode>
		</it:tree>
		
		<a4j:log />
	</h:form>
</h:body>
</html>
