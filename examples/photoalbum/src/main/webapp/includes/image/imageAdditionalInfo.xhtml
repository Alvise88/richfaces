<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:r="http://richfaces.org/core"
    xmlns:r="http://richfaces.org/core" xmlns:richx="http://richfaces.org/richx">
    <h:panelGroup layout="block" style="margin-top : 20px">
        <h:outputText styleClass="bold" value="#{messages['tags']}: " />
        <r:repeat value="#{model.selectedImage.imageTags}" var="tag">
            <r:commandLink actionListener="#{controller.showTag(tag)}" render="mainArea" value="#{tag.tag}" />
            <h:outputText value=" " />
        </r:repeat>
    </h:panelGroup>

    <h:panelGroup rendered="#{model.selectedImage.allowComments}" layout="block" id="commentPanel"
        style="margin-top : 30px; width:100%;">
        <h:panelGroup style="padding-bottom:15px;">
            <h:outputText styleClass="bold" value="#{messages['comment.comments']}:" />
        </h:panelGroup>

        <r:repeat value="#{model.selectedImage.comments}" var="comment">
            <h:panelGroup layout="block" style="clear:both; padding-bottom:10px;padding-top:10px;">
                <h:panelGroup layout="block" styleClass="preview_box_photo_nav" style="margin-right : 5px; float:left;">
                    <h:graphicImage styleClass="pr_photo_bg" value="/img/shell/frame_photo_200.png" />
                    <h:panelGrid cellpadding="0">
                        <h:panelGroup>
                            <r:commandLink render="mainArea" actionListener="#{controller.showUser(comment.author)}">
                                <r:mediaOutput rendered="#{comment.author.hasAvatar}" element="img"
                                    createContent="#{imageLoader.paintImage}" styleClass="additional-info-avatar"
                                    value="/#{comment.author.login}/avatar.jpg" mimeType="image/jpeg" />
                                <h:graphicImage rendered="#{!comment.author.hasAvatar and comment.author.sex.key =='1' }"
                                    value="/img/shell/avatar_default.png" width="80" height="80" alt="" style="border:none" />
                                <h:graphicImage rendered="#{!comment.author.hasAvatar and comment.author.sex.key =='0' }"
                                    value="/img/shell/avatar_w_default.png" width="80" height="80" alt="" style="border:none" />
                            </r:commandLink>
                            <br />
                        </h:panelGroup>
                    </h:panelGrid>
                </h:panelGroup>

                <h:panelGroup layout="block" styleClass="comment-deleteLink">
                    <h:panelGroup rendered="#{comment.author == userBean.user}" layout="block"
                        styleClass="additional-info-comment-del">
                        <r:commandLink value="#{messages['comment.delete']}"
                            actionListener="#{imageManager.deleteComment(comment)}" render="commentPanel" />
                    </h:panelGroup>
                    <h:panelGroup layout="block">
                        <h:outputText styleClass="bold" value="#{comment.author.login} " />
                        <h:outputText styleClass="additional-info-text" value="#{comment.date}">
                            <f:convertDateTime />
                        </h:outputText>
                    </h:panelGroup>
                </h:panelGroup>
                <h:panelGroup style="width:600px;overflow-x:auto;" layout="block" styleClass="comment-text">
                    <!-- this won't be formatted -->
                    <h:outputText value="#{comment.message}" />
                </h:panelGroup>
            </h:panelGroup>
        </r:repeat>
        <h:panelGroup layout="block" style="padding-top:10px; clear:both">
            <r:region rendered="#{userBean.loggedIn}" id="commentEditor">
                <h:panelGroup layout="block" id="editContent">
                    <!-- TODO: add configuration -->
                    <r:editor value="#{imageManager.message}" toolbar="basic" id="editor2" width="400" height="200"
                        skin="richfaces" />
                </h:panelGroup>
            </r:region>
        </h:panelGroup>
        <richx:commandButton rendered="#{userBean.loggedIn}" value="#{messages['comment.add']}"
            actionListener="#{imageManager.addComment(model.selectedImage)}" render="commentPanel" execute="commentEditor" />
    </h:panelGroup>
    <h:panelGroup rendered="#{!model.selectedImage.allowComments}" layout="block" id="commentPanel2" style="margin-top : 30px">
        <h:outputText styleClass="bold" value="#{messages['comments_for_this_photo_is_not_allowed']}" />
    </h:panelGroup>
</ui:composition>